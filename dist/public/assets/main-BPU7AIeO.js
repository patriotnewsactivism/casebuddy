(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))d(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function m(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function d(c){if(c.ep)return;c.ep=!0;const a=m(c);fetch(c.href,a)}})();(function(){function r(){return Date.now().toString(36)+Math.random().toString(36).substring(2,10)}let o=[];async function m(){try{let t="/api/cases";(window.location.hostname.includes("netlify.app")||!window.location.hostname.includes("localhost")&&!window.location.hostname.includes("127.0.0.1"))&&(t="/.netlify/functions/api/cases");const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){return console.error("Error fetching cases from API:",t),null}}try{const t=localStorage.getItem("cases");o=t?JSON.parse(t):[],Array.isArray(o)||(o=[]),o.length===0&&m().then(e=>{e&&Array.isArray(e)&&e.length>0&&(o=e,displayCases(o),localStorage.setItem("cases",JSON.stringify(o)))})}catch(t){console.warn("Error reading cases from storage",t),o=[],m().then(e=>{e&&Array.isArray(e)&&e.length>0&&(o=e,displayCases(o))})}const d=document.getElementById("cases-list"),c=document.getElementById("search-input"),a=document.getElementById("search-results"),l=document.getElementById("new-case-form"),h=document.getElementById("case-title"),u=document.getElementById("case-description");document.getElementById("case-details");const y=document.getElementById("no-selection"),p=document.getElementById("case-info"),E=document.getElementById("case-title-display"),v=document.getElementById("case-description-display"),g=document.getElementById("documents-list"),P=document.getElementById("add-document-form"),N=document.getElementById("document-name"),B=document.getElementById("document-file"),I=document.getElementById("similar-cases-list"),b=document.getElementById("find-similar-cases-btn"),T=document.getElementById("evidence-list"),z=document.getElementById("add-evidence-form"),A=document.getElementById("evidence-name"),x=document.getElementById("evidence-file"),D=document.getElementById("timeline-list"),H=document.getElementById("add-timeline-form"),S=document.getElementById("timeline-date"),k=document.getElementById("timeline-title"),F=document.getElementById("timeline-description"),w=document.getElementById("foia-list"),j=document.getElementById("add-foia-form"),M=document.getElementById("foia-subject"),L=document.getElementById("foia-description");function f(){try{localStorage.setItem("cases",JSON.stringify(o))}catch(t){console.error("Failed to save cases",t)}}function $(t){return o.find(e=>e.id===t)}function R(){if(d.innerHTML="",o.length===0){const t=document.createElement("li");t.textContent="No cases. Add one to get started.",d.appendChild(t);return}o.forEach(t=>{const e=document.createElement("li");e.textContent=t.title||"Untitled case",e.dataset.caseId=t.id,e.addEventListener("click",()=>O(t.id)),d.appendChild(e)})}function O(t){const e=$(t);if(!e){y.style.display="block",p.classList.add("hidden");return}y.style.display="none",p.classList.remove("hidden"),E.textContent=e.title||"Untitled case",v.textContent=e.description||"",q(e),J(e),U(e),K(e),X(e)}function X(t){I.innerHTML="",b.onclick=async()=>{try{b.textContent="Finding similar cases...",b.disabled=!0;const e=await fetch(`/api/cases/${t.id}/similar`);if(!e.ok)throw new Error(`Failed to find similar cases: ${e.status}`);const n=(await e.json()).similarCases;Y(n)}catch(e){console.error("Error finding similar cases:",e),I.innerHTML="<li>Error finding similar cases. Please try again.</li>"}finally{b.textContent="Find Similar Cases",b.disabled=!1}}}function Y(t){if(I.innerHTML="",!t||t.length===0){const e=document.createElement("li");e.textContent="No similar cases found.",I.appendChild(e);return}t.forEach(e=>{const s=document.createElement("li");s.innerHTML=`
        <div>
          <strong>${e.title}</strong>
          <div>Similarity Score: ${Math.round(e.similarityScore*100)}%</div>
          <div>${e.description||""}</div>
        </div>
      `,I.appendChild(s)})}function q(t){if(g.innerHTML="",!t.documents||t.documents.length===0){const e=document.createElement("li");e.textContent="No documents.",g.appendChild(e);return}t.documents.forEach(e=>{const s=document.createElement("li"),n=document.createElement("a");if(n.textContent=e.name,n.href=e.content||"#",n.target="_blank",e.content||n.addEventListener("click",i=>i.preventDefault()),s.appendChild(n),e.content){const i=document.createElement("button");i.textContent="Analyze",i.className="analyze-btn",i.onclick=()=>ne(e.id),s.appendChild(i)}g.appendChild(s)})}function J(t){if(T.innerHTML="",!t.evidence||t.evidence.length===0){const e=document.createElement("li");e.textContent="No evidence.",T.appendChild(e);return}t.evidence.forEach(e=>{const s=document.createElement("li"),n=document.createElement("a");n.textContent=e.name,n.href=e.url||"#",n.target="_blank",e.url||n.addEventListener("click",i=>i.preventDefault()),s.appendChild(n),T.appendChild(s)})}function U(t){if(D.innerHTML="",!t.timeline||t.timeline.length===0){const e=document.createElement("li");e.textContent="No timeline events.",D.appendChild(e);return}t.timeline.forEach(e=>{const s=document.createElement("li");s.innerHTML=`
        <div>
          <strong>${e.title}</strong>
          ${e.date?`<div class="date">${e.date}</div>`:""}
          <div>${e.description||""}</div>
        </div>
      `,D.appendChild(s)})}function K(t){if(w.innerHTML="",!t.foia||t.foia.length===0){const e=document.createElement("li");e.textContent="No FOIA requests.",w.appendChild(e);return}t.foia.forEach(e=>{const s=document.createElement("li");s.innerHTML=`
        <div>
          <strong>${e.subject}</strong>
          <div>${e.description||""}</div>
          ${e.status?`<div class="status">Status: ${e.status}</div>`:""}
        </div>
      `,w.appendChild(s)})}function G(t,e){const s={id:r(),title:t,description:e,documents:[],evidence:[],timeline:[],foia:[]};o.push(s),f(),R()}function Q(t,e,s){const n=$(t);if(!n)return;const i={id:r(),name:e,content:s};n.documents=n.documents||[],n.documents.push(i),f(),q(n);try{fetch("/api/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({caseId:n.id,name:i.name,content:i.content})})}catch(C){console.error("Error uploading document:",C)}}function V(t,e,s){const n=$(t);if(!n)return;const i={id:r(),name:e,url:s};n.evidence=n.evidence||[],n.evidence.push(i),f(),J(n)}function Z(t,e,s,n){const i=$(t);if(!i)return;const C={id:r(),date:e,title:s,description:n};i.timeline=i.timeline||[],i.timeline.push(C),f(),U(i)}function ee(t,e,s){const n=$(t);if(!n)return;const i={id:r(),subject:e,description:s,status:"Pending"};n.foia=n.foia||[],n.foia.push(i),f(),K(n)}function te(t){const e=document.createElement("div");e.className="analysis-modal",e.innerHTML=`
      <div class="analysis-content">
        <h3>Document Analysis</h3>
        <button class="close-btn">X</button>
        <div class="analysis-section">
          <h4>Summary</h4>
          <p>${t.summary||"No summary available."}</p>
        </div>
        <div class="analysis-section">
          <h4>Key Entities</h4>
          <p>${t.entities||"No entities identified."}</p>
        </div>
        <div class="analysis-section">
          <h4>Important Dates</h4>
          <p>${t.dates||"No dates identified."}</p>
        </div>
        <div class="analysis-section">
          <h4>Legal Issues</h4>
          <p>${t.legalIssues||"No legal issues identified."}</p>
        </div>
        <div class="analysis-section">
          <h4>Potential Risks</h4>
          <p>${t.risks||"No risks identified."}</p>
        </div>
      </div>
    `,e.querySelector(".close-btn").onclick=()=>{document.body.removeChild(e)},document.body.appendChild(e)}async function ne(t){const e=o.find(n=>n.documents&&n.documents.find(i=>i.id===t));if(!(!e||!e.documents.find(n=>n.id===t)))try{const n=await fetch(`/api/documents/${t}/analysis`);if(!n.ok){n.status===404?alert("Document analysis not found. The document may still be processing."):alert("Failed to retrieve document analysis.");return}const C=(await n.json()).analysis;te(C)}catch(n){console.error("Error analyzing document:",n),alert("Error analyzing document: "+n.message)}}function ie(t){if(!t){a.innerHTML="";return}const e=[],s=t.toLowerCase();o.forEach(n=>{(n.title&&n.title.toLowerCase().includes(s)||n.description&&n.description.toLowerCase().includes(s))&&e.push({type:"case",title:n.title,description:n.description,id:n.id}),n.documents&&n.documents.forEach(i=>{(i.name&&i.name.toLowerCase().includes(s)||i.content&&i.content.toLowerCase().includes(s))&&e.push({type:"document",title:i.name,description:i.content?i.content.substring(0,100)+"...":"",id:i.id,caseId:n.id})}),n.evidence&&n.evidence.forEach(i=>{i.name&&i.name.toLowerCase().includes(s)&&e.push({type:"evidence",title:i.name,description:i.url||"",id:i.id,caseId:n.id})}),n.timeline&&n.timeline.forEach(i=>{(i.title&&i.title.toLowerCase().includes(s)||i.description&&i.description.toLowerCase().includes(s)||i.date&&i.date.includes(t))&&e.push({type:"timeline",title:i.title,description:i.description,id:i.id,caseId:n.id,date:i.date})}),n.foia&&n.foia.forEach(i=>{(i.subject&&i.subject.toLowerCase().includes(s)||i.description&&i.description.toLowerCase().includes(s))&&e.push({type:"foia",title:i.subject,description:i.description?i.description.substring(0,100)+"...":"",id:i.id,caseId:n.id})})}),se(e)}function se(t){if(a.innerHTML="",t.length===0){const e=document.createElement("li");e.textContent="No results found.",a.appendChild(e);return}t.forEach(e=>{const s=document.createElement("li");s.innerHTML=`
        <div>
          <strong>${e.title}</strong>
          <div class="type">${e.type}</div>
          <div>${e.description||""}</div>
          ${e.date?`<div class="date">${e.date}</div>`:""}
        </div>
      `,e.type!=="case"?s.addEventListener("click",()=>O(e.caseId)):s.addEventListener("click",()=>O(e.id)),a.appendChild(s)})}l.addEventListener("submit",t=>{t.preventDefault();const e=h.value.trim(),s=u.value.trim();e&&(G(e,s),h.value="",u.value="")}),P.addEventListener("submit",t=>{t.preventDefault();const e=p.dataset.selectedCaseId,s=N.value.trim(),n=B.files[0];if(e&&s&&n){const i=new FileReader;i.onload=C=>{Q(e,s,C.target.result),N.value="",B.value=""},i.readAsText(n)}}),z.addEventListener("submit",t=>{t.preventDefault();const e=p.dataset.selectedCaseId,s=A.value.trim(),n=x.files[0];if(e&&s&&n){const i=new FileReader;i.onload=C=>{V(e,s,C.target.result),A.value="",x.value=""},i.readAsDataURL(n)}}),H.addEventListener("submit",t=>{t.preventDefault();const e=p.dataset.selectedCaseId,s=S.value,n=k.value.trim(),i=F.value.trim();e&&n&&(Z(e,s,n,i),S.value="",k.value="",F.value="")}),j.addEventListener("submit",t=>{t.preventDefault();const e=p.dataset.selectedCaseId,s=M.value.trim(),n=L.value.trim();e&&s&&(ee(e,s,n),M.value="",L.value="")}),c.addEventListener("input",t=>{ie(t.target.value.trim())}),R()})();function _(r){return new Promise(o=>{setTimeout(()=>{o({summary:"This document appears to be a legal contract between two parties outlining terms of service and payment conditions.",entities:{people:["John Smith","Jane Doe"],organizations:["Acme Corp","Legal Services LLC"],locations:["New York","California"]},dates:["2025-09-15: Contract signing date","2026-09-15: Contract expiration date"],legalIssues:["Potential ambiguity in payment terms (Section 3)","Missing dispute resolution clause"],risks:["Early termination penalties may be excessive","Indemnification clause is broadly worded"]})},1500)})}function oe(r){return new Promise(o=>{setTimeout(()=>{o({evidenceType:"Document - Contract",tags:["legal","agreement","financial","services"],confidence:92,explanation:"This appears to be a legal contract based on the formal structure, legal terminology, and presence of signature blocks."})},1e3)})}function ae(r){return new Promise(o=>{setTimeout(()=>{o({events:[{event:"Discovery phase begins",date:"2025-10-15",confidence:85,explanation:"Based on the case filing date and typical legal proceedings timeline."},{event:"Expert witness testimonies",date:"2025-12-10",confidence:72,explanation:"Technical nature of the case suggests expert witnesses will be required."},{event:"Settlement negotiation",date:"2026-02-20",confidence:65,explanation:"Based on case complexity and financial implications."}]})},1200)})}function ce(r){return new Promise(o=>{setTimeout(()=>{o({optimizedRequest:`Under the Freedom of Information Act, I request copies of the following records:

1. All contracts between [Agency] and [Company] from January 1, 2023 to present.
2. All correspondence between [Agency] officials and [Company] representatives regarding these contracts.
3. All invoices submitted by [Company] and payment records from [Agency] related to these contracts.

This request is made for non-commercial research purposes. I request a fee waiver as disclosure of this information is in the public interest and will contribute to public understanding of government operations.

Please provide these records in electronic format if possible. If you deny any part of this request, please cite the specific exemptions you believe justify your refusal and notify me of appeal procedures.`,explanation:"The optimized request includes specific date ranges, clearly identifies the records sought, provides a fee waiver justification, and requests electronic format.",keyImprovements:["Added specific date range to narrow scope","Clearly categorized requested documents","Included fee waiver justification","Specified preferred format","Added appeal rights language"]})},1e3)})}function re(r){return new Promise(o=>{setTimeout(()=>{o({researchSummary:"This research focuses on contract disputes involving service agreements in California. Several relevant cases and statutes were identified that may apply to the current case.",relevantCases:[{caseName:"Smith v. Enterprise Solutions",citation:"123 Cal.App.4th 456 (2024)",summary:"Court held that ambiguous terms in service contracts are generally construed against the drafter.",relevance:"Directly applicable to the contract interpretation issues in the current case."},{caseName:"Johnson Consulting v. Tech Innovations",citation:"234 Cal.App.5th 789 (2023)",summary:"Established standards for determining reasonable notice periods for contract termination.",relevance:"Relevant to the termination clause dispute in the current case."}],relevantLaws:[{lawName:"California Civil Code",citation:"Section 1649",summary:"If the terms of a promise are in any respect ambiguous or uncertain, it must be interpreted in the sense in which the promisor believed, at the time of making it, that the promisee understood it.",relevance:"Provides statutory basis for interpreting ambiguous contract terms."},{lawName:"California Business and Professions Code",citation:"Section 17200",summary:"Prohibits unfair competition, including any unlawful, unfair or fraudulent business act or practice.",relevance:"May apply if contract terms are deemed unfair or deceptive."}],researchStrategy:"Focus on California case law regarding service contract disputes from the past five years. Examine statutory provisions related to contract interpretation and unfair business practices."})},1500)})}function W(r){return new Promise(o=>{setTimeout(()=>{o([{id:"sim1",title:"Johnson v. TechCorp",description:"Contract dispute involving software development services",similarityScore:87,keyFactors:["service contract","payment dispute","delivery timeline"]},{id:"sim2",title:"WebDev Solutions v. MarketingPro",description:"Breach of contract case for digital marketing services",similarityScore:72,keyFactors:["service agreement","quality standards","termination clause"]},{id:"sim3",title:"Creative Design v. RetailChain",description:"Dispute over intellectual property rights in service contract",similarityScore:65,keyFactors:["intellectual property","service agreement","licensing terms"]}])},1e3)})}function de(r){const o=document.createElement("div");o.className="modal",o.id="document-analysis-modal";const m=document.createElement("div");m.className="modal-content";const d=document.createElement("div");d.className="modal-header";const c=document.createElement("h3");c.textContent="AI Document Analysis";const a=document.createElement("span");a.className="modal-close",a.innerHTML="&times;",a.onclick=()=>o.remove(),d.appendChild(c),d.appendChild(a);const l=document.createElement("div");l.className="modal-body";const h=document.createElement("div");h.className="analysis-section";const u=document.createElement("h4");u.textContent="Summary";const y=document.createElement("p");y.textContent=r.summary,h.appendChild(u),h.appendChild(y);const p=document.createElement("div");p.className="analysis-section";const E=document.createElement("h4");E.textContent="Entities";const v=document.createElement("div");v.className="entities-list";const g=document.createElement("div"),P=document.createElement("h5");P.textContent="People:";const N=document.createElement("p");N.textContent=r.entities.people.join(", "),g.appendChild(P),g.appendChild(N);const B=document.createElement("div"),I=document.createElement("h5");I.textContent="Organizations:";const b=document.createElement("p");b.textContent=r.entities.organizations.join(", "),B.appendChild(I),B.appendChild(b);const T=document.createElement("div"),z=document.createElement("h5");z.textContent="Locations:";const A=document.createElement("p");A.textContent=r.entities.locations.join(", "),T.appendChild(z),T.appendChild(A),v.appendChild(g),v.appendChild(B),v.appendChild(T),p.appendChild(E),p.appendChild(v);const x=document.createElement("div");x.className="analysis-section";const D=document.createElement("h4");D.textContent="Important Dates";const H=document.createElement("ul");r.dates.forEach(L=>{const f=document.createElement("li");f.textContent=L,H.appendChild(f)}),x.appendChild(D),x.appendChild(H);const S=document.createElement("div");S.className="analysis-section";const k=document.createElement("h4");k.textContent="Legal Issues";const F=document.createElement("ul");r.legalIssues.forEach(L=>{const f=document.createElement("li");f.textContent=L,F.appendChild(f)}),S.appendChild(k),S.appendChild(F);const w=document.createElement("div");w.className="analysis-section";const j=document.createElement("h4");j.textContent="Potential Risks";const M=document.createElement("ul");r.risks.forEach(L=>{const f=document.createElement("li");f.textContent=L,M.appendChild(f)}),w.appendChild(j),w.appendChild(M),l.appendChild(h),l.appendChild(p),l.appendChild(x),l.appendChild(S),l.appendChild(w),m.appendChild(d),m.appendChild(l),o.appendChild(m),document.body.appendChild(o),setTimeout(()=>{o.style.display="block"},100)}document.addEventListener("DOMContentLoaded",function(){const r=()=>{document.querySelectorAll("#documents-list li").forEach(c=>{if(!c.querySelector(".analyze-btn")){const a=document.createElement("button");a.className="analyze-btn",a.textContent="Analyze",a.onclick=async l=>{l.stopPropagation(),a.innerHTML='<span class="loading"></span> Analyzing...';const h=c.textContent.split(":")[0];try{const u=await _(h);de(u)}catch(u){console.error("Analysis failed:",u)}finally{a.textContent="Analyze"}},c.appendChild(a)}})},o=()=>{const d=document.getElementById("find-similar-cases-btn");d&&(d.onclick=async()=>{const c=document.getElementById("case-title-display").textContent,a=document.getElementById("case-description-display").textContent;d.innerHTML='<span class="loading"></span> Finding...';try{const l=await W({title:c,description:a}),h=document.getElementById("similar-cases-list");h.innerHTML="",l.forEach(u=>{const y=document.createElement("li"),p=document.createElement("strong");p.textContent=u.title;const E=document.createElement("span");E.className="similarity-badge",E.textContent=`${u.similarityScore}% match`;const v=document.createElement("p");v.textContent=u.description;const g=document.createElement("small");g.textContent=`Key factors: ${u.keyFactors.join(", ")}`,y.appendChild(p),y.appendChild(E),y.appendChild(v),y.appendChild(g),h.appendChild(y)})}catch(l){console.error("Finding similar cases failed:",l)}finally{d.textContent="Find Similar Cases"}})};new MutationObserver(d=>{d.forEach(c=>{c.type==="childList"&&(r(),o())})}).observe(document.body,{childList:!0,subtree:!0}),r(),o()});window.CaseBuddyAI={analyzeDocument:_,classifyEvidence:oe,predictTimelineEvents:ae,optimizeFOIARequest:ce,conductLegalResearch:re,findSimilarCases:W};
